<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>GitHub and the Web | Dashboard</title>
    <!--Library code -->
    <script src="js/lib/jquery-2.1.3.js"></script>
    <script src="js/lib/d3.js" charset="utf-8"></script>
    <script src="js/lib/queue.v1.js"></script>
    <script src="js/lib/d3.tip.v0.6.6.js"></script>
    <script src="js/lib/intro.js"></script>


    <!--
    <script src="js/preloader.js"></script>
    -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <!-- Styles from http://testthewebforward.org/ -->
    <link rel="stylesheet" href="css/custom.css" type="text/css" media="screen">
    <!-- Visualization Styles -->
    <link rel="stylesheet" href="css/vis.css" type="text/css" media="screen">
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/preloader.css" rel="stylesheet" />
    <link href="css/introjs.css" rel="stylesheet" />

    <!--Vis code-->
    <script src="js/util.js"></script>
    <script src="js/processData.js"></script>
    <script src="js/specvis.js"></script>
    <script src="js/whovis.js"></script>
    <script src="js/timelinevis.js"></script>
    <script src="js/filterui.js"></script>
</head>
<body>

<div id="wrapper">

    <!-- header -->

    <header>

        <div class="navbar navbar-default navbar-static-top">
            <div class="container">
                <div class="navbar-header"></div>
                <h1><span class="navbar-header"><img class="w3c" src="images/w3c.jpg" width="100%" height="100%"></span></h1>

                <div class="navbar-collapse collapse ">

                    <ul style="float:right" class="navbar-header">
                       <h1><span class="navbar-header"><img src="images/cs.jpg" width="100%" height="100%"></span></h1>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <!-- main D3 stuff -->

    <div class="container">

        <nav id='cssmenu'>
            <ul>

                <li class='active'><a class="links" id="one" href='#'><span>View By Status</span></a>
                    <ul class='child'>
                        <li class='has-sub'><a id="state_all" href='#'><span>All</span></a>
                        </li>
                        <li class='has-sub'><a id="state_open" href='#'><span>Unresolved Items</span></a>
                        </li>
                    </ul>
                </li>

                <li class='active'><a class="links" href='#'><span>View By Category</span></a>
                    <ul class='child'>
                        <li class='has-sub'><a id="cat_all" href='#'><span>All </span></a>

                        </li>
                        <li class='has-sub'><a id="cat_spec" href='#'><span>Spec Edits</span></a>
                        </li>

                        <li class='has-sub'><a id= "cat_test" href='#'><span>Test Suite Updates</span></a>
                        </li>

                    </ul>
                </li>


                <li class='active'><a class="links" href='#'><span>Sort Contributors</span></a>
                    <ul class='child'>
                        <li class='has-sub'><a id="sort_code" href='#'><span>By Lines of Code Touched</span></a>

                        </li>
                        <li class='has-sub'><a id="sort_issue" href='#'><span>By Issues Raised</span></a>
                        </li>
                    </ul>
                </li>

                <li class='active'><a class="links" href='#'><span>CanIUse</span></a>
                    <ul class='child'>
                        <li class='has-sub'><a id="caniuse_true" href='#'><span>Show</span></a>
                        </li>
                        <li class='has-sub'><a id="caniuse_false" href='#'><span>Hide</span></a>
                        </li>
                    </ul>
                </li>

                <li class='active'><a class="links" href='#'><span>About</span></a>
                    <ul class='child'>
                        <li class='has-sub'><a href='https://github.com/jlehegaret/cs171-project/tree/master/dashboard/data'><span>Our Data</span></a>
                        </li>

                        <li class='has-sub'><a href='https://github.com/jlehegaret/cs171-project/blob/master/process_doc/toc.md'><span>Process Document</span></a>
                        </li>

                        <li class='has-sub'><a href='#'><span>View the Screencast</span></a>
                        </li>

                        <li id="walkthrough" class='has-sub'><a href='#'><span>Launch a WalkThrough</span></a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>


        <!--<div id="loader-wrapper">-->
            <!--<div id="loader"></div>-->

            <!--<div class="loader-section section-left"></div>-->
            <!--<div class="loader-section section-right"></div>-->

        <!--</div>-->


        <div style="float:left" id="specVis"></div>

        <div id="whereAmI">
            <p>Where am I? </p>
            <p>Viewing: <span id="viewingLabel">All Work Done</span></p>
            <p>Timeframe: <span id="timeframeLabelStart">Date</span> to <span id="timeframeLabelEnd">Date</span></p>
            <p>Working Group: <span id="wgLabel">All</span></p>
            <p>Spec: <span id="specLabel">All</span></p>
            <p>Contributor: <span id="whoLabel">All</span></p>
        </div>

        <div id="legend"> <img src="images/legend.png" width="100%" height="100%"> </div>
        <div>
            <p class="whoHeadline" style="float:right; margin-bottom: 0px; margin-top: 20px; margin-right: 15px;"> Contributors </p>
            <!--<p class="whoHeadline" id="line" style="float:right; margin-bottom: 0px; margin-top: 20px; margin-right: 15px;" onclick="slide()"> linear </p>-->
            <!--<p class="whoHeadline" id="fish" style="float:right; margin-bottom: 0px; margin-top: 20px; margin-right: 15px;"> fisheye </p>-->
        </div>
        <div id="whoVis">
        </div>

        <div id="timelineVis-zoom"></div>
        <div id="timelineVis-whole"></div>
    </div>

    <div class="footer">

  </div>

</div>

<script>
    $(document).ready(function() {
        //Global data variables
        var allData = {caniuse: [], groups: [], specs: [], tests: []};

        //If this object is passed to visualization, it will override the default filters
        var initialFilters = {
            start_date: "2014-01-01",
            end_date: "2015-05-05",    // needs to be in this format
                            // new Date() breaks whovis filtering code
            state: "all",           //open or all
            category: ["spec", "test"],        // all, spec, or test
            specs: [],          // array of which specs to show.
                                //    empty = all.
            caniuse: false,     // change sunburst color
                                // to reflect caniuse score
            who: null,          // or can be one name
            who_sort: "code"   // or issues
        };

        var initVis = function () {
            //Handles timeline brushing
            var brushHandler = {};
            //Handles sunburst selection changing
            var selectionHandler = {};
            //Handles whovis author selection changing
            var authorHandler = {};
            //Handles filter options from UI
            var filterHandler = {};


            //Create visualizations
            filter_ui = new FilterUI(d3.select("#whereAmI"), initialFilters, filterHandler);
            spec_vis = new SpecVis(d3.select("#specVis"), allData, selectionHandler, initialFilters);
            who_vis = new WhoVis(d3.select("#whoVis"), allData, authorHandler, initialFilters);
            timeline_zoom = new TimelineVis(d3.select("#timelineVis-zoom"), allData, {}, initialFilters,
                { width:1200, height:200, doBrush: false, doTooltips: true});
            timeline_whole = new TimelineVis(d3.select("#timelineVis-whole"), allData, brushHandler, initialFilters,
                { width:1200, height:200, doBrush: true, doTooltips: false});


            //End preload animation
            $('body').addClass('loaded');

            //Wire up event handlers
            $(brushHandler).bind("brushChanged", function (event, selectionStart, selectionEnd) {
                spec_vis.onTimelineChange(selectionStart, selectionEnd);
                who_vis.onTimelineChange(selectionStart, selectionEnd);
                filter_ui.onTimelineChange(selectionStart, selectionEnd);
                timeline_zoom.onTimelineChange(selectionStart, selectionEnd);
            });
            $(selectionHandler).bind("selectionChanged", function (event, specSelection) {
                timeline_zoom.onSelectionChange(specSelection);
                who_vis.onSelectionChange(specSelection);
                filter_ui.onSelectionChange(specSelection);
                // console.log(specSelection);
            });
            $(authorHandler).bind("authorChanged", function (event, author) {
                spec_vis.onAuthorChange(author);
                timeline_zoom.onAuthorChange(author);
                filter_ui.onAuthorChange(author);
            });
            $(filterHandler).bind("filterChanged", function(event, filters) {
 //                console.log("Filters changed");
 //                console.log(filters);
                spec_vis.onFilterChange(filters);
                timeline_zoom.onFilterChange(filters);
                who_vis.onFilterChange(filters);
            });
        };
        var dataLoaded = function (error, _caniuse, _groups, _specs, _tests) {
            if (!error) {
                //See processData.js
                allData = processData(_caniuse, _groups, _specs, _tests);

                //log the data structures, remove for production
                //logData();
                initVis();
            } else {
                console.log("Error loading data!:" + error);
            }
        };
        var init = function () {
            //asynchronously load data
            queue()
                    .defer(d3.json, "data/caniuse.json")
                    .defer(d3.json, "data/groups.json")
                    .defer(d3.json, "data/specs.json")
                    .defer(d3.json, "data/tests.json")
                    .await(dataLoaded);
        };
        init();

        ////for navbar transition/////

        $(function () {
            $('.links').on('click', function () {
                $(this).parent('.active').children('.child').slideToggle(function() {
                    $(this).toggleClass('in out');
                });
            });
        });

        ////invisible slider/////

            // var $gal   =  $("#whoVis"),
            //         galW   = 1000,
            //         galSW  = 7800, // here define dynamic width with svgWhoVis
            //         wDiff  = (galSW/galW)-1,  // widths difference ratio
            //         mPadd  = 0,  // Mousemove Padding
            //         damp   = 2,  // Mousemove response softness
            //         mX     = 0,   // Real mouse position
            //         mX2    = 0,   // Modified mouse position
            //         posX   = 0,
            //         mmAA   = galW-(mPadd*2), // The mousemove available area
            //         mmAAr  = (galW/mmAA);    // get available mousemove fidderence ratio

            // console.log(galW, galSW)

            // $gal.mousemove(function(e) {
            //     mX = e.pageX - $(this).parent().offset().left - this.offsetLeft;
            //     mX2 = Math.min( Math.max(100, mX-mPadd), mmAA ) * mmAAr;
            // });

            // setInterval(function(){
            //     posX += (mX2 - posX) / damp; // zeno's paradox equation "catching delay"
            //     $gal.scrollLeft(posX*wDiff);
            // }, 10);


        /////walkthrought/////

        $(function(){
            var introguide = introJs();
           // var startbtn   = $('#startdemotour');

            $("#walkthrough").click(function() {
                introguide.start();
            });

            introguide.setOptions({
                steps: [
                    {
                        element: '.navbar-collapse collapse ',
                        intro: 'This guided tour will explain Git the Web Forward interface.<br><br>Use the arrow keys for navigation or hit ESC to exit the tour immediately.',
                        position: 'bottom'
                    },
                    {
                        element: '#specVis',
                        intro: 'This is Sunburst/SpecVis view....',
                        position: 'bottom'
                    },
                    {
                        element: '#timelineVis',
                        intro: 'This is Timeline view...',
                        position: 'bottom'
                    },
                    {
                        element: '#whoVis',
                        intro: 'This is Who view...',
                        position: 'right'
                    },
                    {
                        element: '#cssmenu',
                        intro: "This is navigation menu for sorting/filtering...",
                        position: 'bottom'
                    },
                    {
                        element: '#whereAmI',
                        intro: "This is Where Am I part...",
                        position: 'bottom'
                    },
                    {
                        element: '#legend',
                        intro: "The legend shows colors...",
                        position: 'bottom'
                    }
                ]
            });

        });

    });
</script>
</body>
</html>
